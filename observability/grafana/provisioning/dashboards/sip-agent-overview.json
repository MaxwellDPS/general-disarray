{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [
    {
      "asDropdown": false,
      "icon": "external link",
      "includeVars": false,
      "keepTime": true,
      "tags": [],
      "targetBlank": true,
      "title": "Speaches Dashboard",
      "type": "link",
      "url": "/d/speaches-overview"
    },
    {
      "asDropdown": false,
      "icon": "external link",
      "includeVars": false,
      "keepTime": true,
      "tags": [],
      "targetBlank": true,
      "title": "GPU Dashboard",
      "type": "link",
      "url": "/d/gpu-overview"
    }
  ],
  "liveNow": false,
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 100,
      "panels": [],
      "title": "üìä System Status",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "blue", "value": null }] },
          "unit": "none"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 0, "y": 1 },
      "id": 1,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "sum(sip_calls_started_total) or vector(0)", "refId": "A" }],
      "title": "Total Calls",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "none"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 4, "y": 1 },
      "id": 2,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "sum(increase(sip_calls_started_total[1h])) or vector(0)", "refId": "A" }],
      "title": "Calls (1h)",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "orange", "value": null }, { "color": "red", "value": 1 }] },
          "unit": "none"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 8, "y": 1 },
      "id": 3,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "sum(sip_calls_failed_total) or vector(0)", "refId": "A" }],
      "title": "Failed Calls",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 500 }, { "color": "red", "value": 1000 }] },
          "unit": "ms"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 12, "y": 1 },
      "id": 4,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "histogram_quantile(0.95, sum(rate(sip_stt_latency_milliseconds_bucket[5m])) by (le))", "refId": "A" }],
      "title": "STT p95",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 500 }, { "color": "red", "value": 1000 }] },
          "unit": "ms"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 16, "y": 1 },
      "id": 5,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "histogram_quantile(0.95, sum(rate(sip_tts_latency_milliseconds_bucket[5m])) by (le))", "refId": "A" }],
      "title": "TTS p95",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 2000 }, { "color": "red", "value": 5000 }] },
          "unit": "ms"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 20, "y": 1 },
      "id": 6,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "histogram_quantile(0.95, sum(rate(sip_llm_latency_milliseconds_bucket[5m])) by (le))", "refId": "A" }],
      "title": "LLM p95",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "blue", "value": null }, { "color": "yellow", "value": 1 }, { "color": "red", "value": 3 }] },
          "unit": "none"
        }
      },
      "gridPos": { "h": 4, "w": 3, "x": 0, "y": 5 },
      "id": 7,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "sum(sip_calls_active) or vector(0)", "refId": "A" }],
      "title": "Active Calls",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 5 }, { "color": "red", "value": 10 }] },
          "unit": "none"
        }
      },
      "gridPos": { "h": 4, "w": 3, "x": 3, "y": 5 },
      "id": 8,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "sum(increase(sip_calls_silence_timeout_total[1h])) or vector(0)", "refId": "A" }],
      "title": "Silence Timeouts (1h)",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 3 }, { "color": "red", "value": 10 }] },
          "unit": "none"
        }
      },
      "gridPos": { "h": 4, "w": 3, "x": 6, "y": 5 },
      "id": 9,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "sum(increase(sip_llm_errors_total[1h])) or vector(0)", "refId": "A" }],
      "title": "LLM Errors (1h)",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 9 },
      "id": 101,
      "panels": [],
      "title": "üí¨ Conversation Log",
      "type": "row"
    },
    {
      "datasource": { "type": "loki", "uid": "loki" },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 10 },
      "id": 10,
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "prettifyLogMessage": false,
        "showCommonLabels": false,
        "showLabels": false,
        "showTime": true,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "targets": [{
        "expr": "{service_name=\"sip-agent\"} | json | event_type =~ `user_speech|assistant_response|assistant_ack|tool_call` | line_format `{{if eq .event_type \"user_speech\"}}üé§ User: {{.event_data_text}}{{else if eq .event_type \"assistant_response\"}}ü§ñ Assistant: {{.event_data_text}}{{else if eq .event_type \"assistant_ack\"}}üí¨ Ack: {{.event_data_text}}{{else if eq .event_type \"tool_call\"}}üîß Tool: {{.event_data_tool}}({{.event_data_params}}){{end}}`",
        "refId": "A"
      }],
      "title": "Conversation Transcript",
      "type": "logs"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 14 },
      "id": 102,
      "panels": [],
      "title": "üìû Call Metrics",
      "type": "row"
    },
    {
      "datasource": { "type": "loki", "uid": "loki" },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 15 },
      "id": 20,
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "prettifyLogMessage": false,
        "showCommonLabels": false,
        "showLabels": false,
        "showTime": true,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "targets": [{
        "expr": "{service_name=\"sip-agent\"} |~ \"call_start|call_end|sip_call_state|sip_registration|sip_incoming_call|sip_outbound_call|sip_call_connected|call_timeout\"",
        "refId": "A"
      }],
      "title": "Call Events",
      "type": "logs"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "bars", "fillOpacity": 80, "lineWidth": 0, "stacking": { "group": "A", "mode": "normal" } },
          "unit": "short"
        },
        "overrides": [
          { "matcher": { "id": "byName", "options": "inbound" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "outbound" }, "properties": [{ "id": "color", "value": { "fixedColor": "blue", "mode": "fixed" } }] }
        ]
      },
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 15 },
      "id": 21,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "single" } },
      "targets": [{ "expr": "sum by (call_type) (rate(sip_calls_started_total[5m]))", "legendFormat": "{{call_type}}", "refId": "A" }],
      "title": "Calls Over Time (rate)",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "ms"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 21 },
      "id": 22,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "histogram_quantile(0.50, sum(rate(sip_calls_duration_milliseconds_bucket[5m])) by (le))", "legendFormat": "p50", "refId": "A" },
        { "expr": "histogram_quantile(0.95, sum(rate(sip_calls_duration_milliseconds_bucket[5m])) by (le))", "legendFormat": "p95", "refId": "B" }
      ],
      "title": "Call Duration",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 21 },
      "id": 23,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "sum(rate(sip_calls_failed_total[5m])) by (failure_reason)", "legendFormat": "{{failure_reason}}", "refId": "A" }
      ],
      "title": "Call Failures by Reason",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 27 },
      "id": 103,
      "panels": [],
      "title": "üéôÔ∏è Audio Pipeline (STT/TTS)",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "ms"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 28 },
      "id": 30,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "histogram_quantile(0.50, sum(rate(sip_stt_latency_milliseconds_bucket[5m])) by (le))", "legendFormat": "STT p50", "refId": "A" },
        { "expr": "histogram_quantile(0.95, sum(rate(sip_stt_latency_milliseconds_bucket[5m])) by (le))", "legendFormat": "STT p95", "refId": "B" },
        { "expr": "histogram_quantile(0.50, sum(rate(sip_tts_latency_milliseconds_bucket[5m])) by (le))", "legendFormat": "TTS p50", "refId": "C" },
        { "expr": "histogram_quantile(0.95, sum(rate(sip_tts_latency_milliseconds_bucket[5m])) by (le))", "legendFormat": "TTS p95", "refId": "D" }
      ],
      "title": "Audio Pipeline Latency",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 28 },
      "id": 31,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "sum(rate(sip_stt_errors_total[5m])) by (error_type)", "legendFormat": "STT: {{error_type}}", "refId": "A" },
        { "expr": "sum(rate(sip_tts_errors_total[5m])) by (error_type)", "legendFormat": "TTS: {{error_type}}", "refId": "B" }
      ],
      "title": "Audio Errors",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "s"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 34 },
      "id": 32,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "histogram_quantile(0.50, sum(rate(sip_stt_audio_duration_seconds_bucket[5m])) by (le))", "legendFormat": "Input Audio p50", "refId": "A" },
        { "expr": "histogram_quantile(0.50, sum(rate(sip_tts_audio_duration_seconds_bucket[5m])) by (le))", "legendFormat": "Output Audio p50", "refId": "B" }
      ],
      "title": "Audio Duration",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 34 },
      "id": 33,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "rate(sip_vad_speech_segments_total[5m])", "legendFormat": "VAD Segments", "refId": "A" },
        { "expr": "rate(sip_calls_barge_in_total[5m])", "legendFormat": "Barge-ins", "refId": "B" }
      ],
      "title": "VAD & Barge-in Events",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 40 },
      "id": 35,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "histogram_quantile(0.50, sum(rate(sip_tts_characters_bucket[5m])) by (le))", "legendFormat": "Characters p50", "refId": "A" },
        { "expr": "histogram_quantile(0.95, sum(rate(sip_tts_characters_bucket[5m])) by (le))", "legendFormat": "Characters p95", "refId": "B" }
      ],
      "title": "TTS Characters per Request",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 46 },
      "id": 104,
      "panels": [],
      "title": "üß† LLM Performance",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "ms"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 47 },
      "id": 40,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "histogram_quantile(0.50, sum(rate(sip_llm_latency_milliseconds_bucket[5m])) by (le))", "legendFormat": "p50", "refId": "A" },
        { "expr": "histogram_quantile(0.95, sum(rate(sip_llm_latency_milliseconds_bucket[5m])) by (le))", "legendFormat": "p95", "refId": "B" },
        { "expr": "histogram_quantile(0.99, sum(rate(sip_llm_latency_milliseconds_bucket[5m])) by (le))", "legendFormat": "p99", "refId": "C" }
      ],
      "title": "LLM Latency",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 47 },
      "id": 41,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "rate(sip_llm_tokens_input_total[5m])", "legendFormat": "Input Tokens/s", "refId": "A" },
        { "expr": "rate(sip_llm_tokens_output_total[5m])", "legendFormat": "Output Tokens/s", "refId": "B" }
      ],
      "title": "LLM Token Throughput",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 53 },
      "id": 42,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "histogram_quantile(0.50, sum(rate(sip_llm_tokens_per_second_bucket[5m])) by (le))", "legendFormat": "TPS p50", "refId": "A" },
        { "expr": "histogram_quantile(0.95, sum(rate(sip_llm_tokens_per_second_bucket[5m])) by (le))", "legendFormat": "TPS p95", "refId": "B" }
      ],
      "title": "LLM Generation Speed (Tokens/sec)",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 53 },
      "id": 43,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "histogram_quantile(0.50, sum(rate(sip_llm_context_tokens_bucket[5m])) by (le))", "legendFormat": "Context Tokens p50", "refId": "A" }
      ],
      "title": "LLM Context Usage",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 59 },
      "id": 44,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "sum by (error_type, llm_model) (rate(sip_llm_errors_total[5m]))", "legendFormat": "{{llm_model}}: {{error_type}}", "refId": "A" }
      ],
      "title": "LLM Errors",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 65 },
      "id": 105,
      "panels": [],
      "title": "üîß Tools",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "bars", "fillOpacity": 80, "lineWidth": 0, "stacking": { "group": "A", "mode": "normal" } },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 66 },
      "id": 50,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "sum by (tool_name) (rate(sip_tools_calls_total[5m]))", "legendFormat": "{{tool_name}}", "refId": "A" }
      ],
      "title": "Tool Calls",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "ms"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 66 },
      "id": 51,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "histogram_quantile(0.50, sum(rate(sip_tools_latency_milliseconds_bucket[5m])) by (le, tool_name))", "legendFormat": "{{tool_name}} p50", "refId": "A" },
        { "expr": "histogram_quantile(0.95, sum(rate(sip_tools_latency_milliseconds_bucket[5m])) by (le, tool_name))", "legendFormat": "{{tool_name}} p95", "refId": "B" }
      ],
      "title": "Tool Latency",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 24, "x": 0, "y": 72 },
      "id": 52,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "sum by (tool_name, error_type) (rate(sip_tools_errors_total[5m]))", "legendFormat": "{{tool_name}}: {{error_type}}", "refId": "A" }
      ],
      "title": "Tool Errors",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "bars", "fillOpacity": 80, "lineWidth": 0, "stacking": { "group": "A", "mode": "normal" } },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 78 },
      "id": 112,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "sum by (tool_name) (rate(sip_tool_success_total[5m]))", "legendFormat": "{{tool_name}} success", "refId": "A" },
        { "expr": "sum by (tool_name) (rate(sip_tool_failures_total[5m]))", "legendFormat": "{{tool_name}} fail", "refId": "B" }
      ],
      "title": "Tool Success/Failure Rate",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [
            { "options": { "realtime": { "color": "green", "text": "Realtime" }, "batch": { "color": "blue", "text": "Batch" } }, "type": "value" }
          ],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "none"
        }
      },
      "gridPos": { "h": 6, "w": 6, "x": 12, "y": 78 },
      "id": 113,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "expr": "sum by (stt_mode) (sip_stt_mode_initializations_total)", "legendFormat": "{{stt_mode}}", "refId": "A" }],
      "title": "STT Mode",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 6, "x": 18, "y": 78 },
      "id": 114,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "sum(rate(sip_realtime_connection_state_changes_total{connection_state=\"connected\"}[5m]))", "legendFormat": "connected", "refId": "A" },
        { "expr": "sum(rate(sip_realtime_connection_state_changes_total{connection_state=\"disconnected\"}[5m]))", "legendFormat": "disconnected", "refId": "B" },
        { "expr": "sum(rate(sip_realtime_reconnections_total[5m]))", "legendFormat": "reconnections", "refId": "C" }
      ],
      "title": "Realtime STT Connection",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 84 },
      "id": 106,
      "panels": [],
      "title": "üí¨ Conversation Quality",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 85 },
      "id": 60,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "histogram_quantile(0.50, sum(rate(sip_conversation_turns_bucket[5m])) by (le))", "legendFormat": "Turns p50", "refId": "A" },
        { "expr": "histogram_quantile(0.95, sum(rate(sip_conversation_turns_bucket[5m])) by (le))", "legendFormat": "Turns p95", "refId": "B" }
      ],
      "title": "Conversation Turns",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 85 },
      "id": 61,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "histogram_quantile(0.50, sum(rate(sip_conversation_user_words_bucket[5m])) by (le))", "legendFormat": "User Words p50", "refId": "A" },
        { "expr": "histogram_quantile(0.50, sum(rate(sip_conversation_assistant_words_bucket[5m])) by (le))", "legendFormat": "Assistant Words p50", "refId": "B" }
      ],
      "title": "Words per Turn",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 91 },
      "id": 107,
      "panels": [],
      "title": "üìã Queue & Callbacks",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2, "staircase": true },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 8, "x": 0, "y": 86 },
      "id": 70,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "sip_queue_depth or vector(0)", "legendFormat": "Queue Depth", "refId": "A" }
      ],
      "title": "Call Queue Depth",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "ms"
        }
      },
      "gridPos": { "h": 6, "w": 8, "x": 8, "y": 86 },
      "id": 71,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "histogram_quantile(0.95, sum(rate(sip_queue_wait_time_milliseconds_bucket[5m])) by (le))", "legendFormat": "Wait Time p95", "refId": "A" }
      ],
      "title": "Queue Wait Time",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 8, "x": 16, "y": 86 },
      "id": 72,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "rate(sip_queue_enqueued_total[5m])", "legendFormat": "Enqueued", "refId": "A" },
        { "expr": "rate(sip_queue_rejected_total[5m])", "legendFormat": "Rejected", "refId": "B" }
      ],
      "title": "Queue Operations",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 92 },
      "id": 73,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "targets": [
        { "expr": "rate(sip_callback_success_total[5m])", "legendFormat": "Success", "refId": "A" },
        { "expr": "sum by (failure_reason) (rate(sip_callback_failed_total[5m]))", "legendFormat": "Failed: {{failure_reason}}", "refId": "B" },
        { "expr": "rate(sip_callback_retries_total[5m])", "legendFormat": "Retries", "refId": "C" }
      ],
      "title": "Webhook Callbacks",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 98 },
      "id": 108,
      "panels": [],
      "title": "üó∫Ô∏è Service Map",
      "type": "row"
    },
    {
      "datasource": { "type": "tempo", "uid": "tempo" },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 99 },
      "id": 80,
      "options": {},
      "targets": [{
        "queryType": "serviceMap",
        "serviceMapQuery": "{}"
      }],
      "title": "Service Map",
      "type": "nodeGraph"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 107 },
      "id": 109,
      "panels": [],
      "title": "‚ö†Ô∏è System Logs",
      "type": "row"
    },
    {
      "datasource": { "type": "loki", "uid": "loki" },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 108 },
      "id": 90,
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "prettifyLogMessage": false,
        "showCommonLabels": false,
        "showLabels": true,
        "showTime": true,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "targets": [{
        "expr": "{service_name=\"sip-agent\"} |~ \"(?i)error|warning|failed|exception\"",
        "refId": "A"
      }],
      "title": "Errors & Warnings",
      "type": "logs"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 116 },
      "id": 110,
      "panels": [],
      "title": "üìú All Logs (Raw)",
      "type": "row"
    },
    {
      "datasource": { "type": "loki", "uid": "loki" },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 117 },
      "id": 91,
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "prettifyLogMessage": true,
        "showCommonLabels": false,
        "showLabels": true,
        "showTime": true,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "targets": [{
        "expr": "{service_name=\"sip-agent\"}",
        "refId": "A"
      }],
      "title": "All Logs (click to expand and see structure)",
      "type": "logs"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 127 },
      "id": 111,
      "panels": [],
      "title": "üìä Available Metrics (Debug)",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "align": "auto", "cellOptions": { "type": "auto" }, "inspect": false },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] }
        }
      },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 128 },
      "id": 92,
      "options": {
        "cellHeight": "sm",
        "footer": { "countRows": false, "fields": "", "reducer": ["sum"], "show": false },
        "showHeader": true
      },
      "targets": [{
        "expr": "count by (__name__) ({__name__=~\"sip_.*\"})",
        "format": "table",
        "instant": true,
        "refId": "A"
      }],
      "title": "Available SIP Metrics",
      "type": "table",
      "transformations": [
        { "id": "organize", "options": { "excludeByName": { "Time": true, "Value": true }, "indexByName": {}, "renameByName": { "__name__": "Metric Name" } } }
      ]
    }
  ],
  "refresh": "5s",
  "schemaVersion": 39,
  "tags": ["sip-agent", "observability", "voice"],
  "templating": { "list": [] },
  "time": { "from": "now-1h", "to": "now" },
  "timepicker": {},
  "timezone": "browser",
  "title": "SIP Agent Overview",
  "uid": "sip-agent-overview",
  "version": 4,
  "weekStart": ""
}